<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts | Academic</title>
    <link>/post/</link>
      <atom:link href="/post/index.xml" rel="self" type="application/rss+xml" />
    <description>Posts</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><lastBuildDate>Thu, 09 Jul 2020 00:00:00 +0000</lastBuildDate>
    <image>
      <url>/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png</url>
      <title>Posts</title>
      <link>/post/</link>
    </image>
    
    <item>
      <title>Add font to a photo</title>
      <link>/post/add-font-to-a-photo/</link>
      <pubDate>Thu, 09 Jul 2020 00:00:00 +0000</pubDate>
      <guid>/post/add-font-to-a-photo/</guid>
      <description>


&lt;p&gt;在正式写推文之前，又发现了一个坑——Markdown的图片路径不支持中文。所以推文的名字不能用中文，因为推文内部的图片都是用推文名字索引的(尴尬)。&lt;/p&gt;
&lt;p&gt;首先看下成果吧。
(原图做了压缩才push上来的)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/6b84e15bgy1gglu2tb81hj20ee0pm4qp.jpg&#34; /&gt;&lt;/p&gt;
&lt;p&gt;在Y叔公众号看到一篇文章(&lt;a href=&#34;https://mp.weixin.qq.com/s/pnU3CH2T0FISCnsxeUQgQg&#34;&gt;用R给高考学生送祝福吧&lt;/a&gt;)，图片中添加文字，用R可以实现。觉得很有意思，于是测试了一下，竟然翻车了。所以将这个过程记录下来，以便有机会用上这个功能。&lt;/p&gt;
&lt;p&gt;实现这个功能用的的R包并不复杂，只有&lt;code&gt;showtext&lt;/code&gt;、&lt;code&gt;ggplot2&lt;/code&gt;和&lt;code&gt;ggimage&lt;/code&gt;三个。&lt;code&gt;showtext&lt;/code&gt;用来显示个性化的字体(如本例用的maocao), &lt;code&gt;ggplot2&lt;/code&gt;用来画图，&lt;code&gt;ggimage&lt;/code&gt;用来添加图片背景。&lt;/p&gt;
&lt;p&gt;一开始加载字体就出现了问题，基于某些特殊原因，未能直接访问google，所以字体只能下载后本地加载。&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(showtext)
font_add(&amp;quot;maocao&amp;quot;, &amp;quot;D:\\Data\\goupanddownwithR\\LiuJianMaoCao-Regular.ttf&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;下一步按照Y叔的操作，打开&lt;code&gt;showtext&lt;/code&gt;，创建ggplot图像，将文字添加进去，并指定了字体maocao，再讲图片导入，一切都很顺利。&lt;/p&gt;
&lt;p&gt;然而最终出来的图和Y叔的不一样——字体没有变。&lt;/p&gt;
&lt;p&gt;于是搜索原因，试了各种方法都没有成功。在stackoverflow上的一个回答引起了我的注意，图形设备竟然还分win和pdf以及png。&lt;/p&gt;
&lt;p&gt;刚好这时候，查到了邱怡轩(&lt;code&gt;showtext&lt;/code&gt;包的作者)在统计之都上的一篇文章。他用R画图，添加的文字都是用Cairo包开启的png设备。于是我也按照指引尝试了一下，果然奏效。&lt;/p&gt;
&lt;p&gt;代码如下：&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(Cairo)
Cairo.capabilities() # 检查Cairo的兼容性
# 打开图形设备
CairoPNG(&amp;quot;leftrighthand.jpg&amp;quot;, 2590, 4608);
showtext_auto()

d = data.frame(x=0:1)

p = ggplot(d, aes(x,x)) + geom_blank() +
  annotate(&amp;quot;text&amp;quot;, x=.73, y=.91, angle = -10,
           label=&amp;quot;左手nature\n右手science&amp;quot;,color = &amp;quot;white&amp;quot;,
           family=&amp;quot;maocao&amp;quot;, size=88) +
  theme_void()

#指定图片位置
img &amp;lt;- &amp;#39;D:/Data/左手nature右手science.jpg&amp;#39;
ggbackground(p, img)

# 停止使用showtext
showtext_end()
# 关闭图形设备
dev.off()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;最后做了个小的尝试，为了方便图片在markdown(这篇博客就是用markdown写的)中的引用，将图片上传到了新浪图床。图片上传图床用的&lt;a href=&#34;https://segmentfault.com/a/1190000020251841&#34;&gt;新浪微博图床插件&lt;/a&gt;,在Chrome应用商店可以直接下载。登录微博账号，即可使用。拖拽上传也非常方便。&lt;/p&gt;
&lt;p&gt;看下图床提供的图片效果，做了一下大小的适配。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://tvax4.sinaimg.cn/wap720/6b84e15bgy1ggluf73y45j20ee0pm4qp.jpg&#34; /&gt;&lt;/p&gt;
&lt;div id=&#34;one-more-thing.&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;One more thing.&lt;/h3&gt;
&lt;p&gt;某次看到Y叔博客的另一个包，也出现了显示问题。里面的解释让我明白了图片上加字体失败的原因，原来就是图形设备的锅。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;showtext 本身和 RStudio GD 存在兼容性问题，所以在 Rstudio 中会出现各种问题，这也是为什么直接用png()保存则正常。因此给出的解决建议是即便在使用 Rstudio，也还是用系统本身的 GD 去打印，在Windows中就用 windows() 在 Mac 中就用 quartz()，然后万事大吉功成身退。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;https://tvax1.sinaimg.cn/mw690/6b84e15bgy1ggrl5prcamj21a40rcu0x.jpg&#34; alt=&#34;&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;图形设备的锅&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>挖坑待填</title>
      <link>/post/%E6%8C%96%E5%9D%91%E5%BE%85%E5%A1%AB/</link>
      <pubDate>Mon, 06 Jul 2020 00:00:00 +0000</pubDate>
      <guid>/post/%E6%8C%96%E5%9D%91%E5%BE%85%E5%A1%AB/</guid>
      <description>


&lt;div id=&#34;统计一下挖过的坑&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;统计一下挖过的坑&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;小麦植株地下部，用R画出来&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;基本思路与地上部分的画法相同，先找轮廓，然后描摹&lt;/li&gt;
&lt;li&gt;图形展示还没想好，可能根部的养分测定，按照区域测的会有区别&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;顺便想起是否可以画地下部不同土层的轮廓，基本构思还需要在考虑一下&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;气象数据的可视化&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;附近气象站点&lt;/li&gt;
&lt;li&gt;气象数据如何获取&lt;/li&gt;
&lt;li&gt;气象数据的筛选与整理&lt;/li&gt;
&lt;li&gt;气象数据展示（柱状图展示降雨，折线散点展示温度等）&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Draw wheat chart in R</title>
      <link>/post/draw-wheat-chart-in-r/</link>
      <pubDate>Sat, 04 Jul 2020 00:00:00 +0000</pubDate>
      <guid>/post/draw-wheat-chart-in-r/</guid>
      <description>


&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/wheatplots.jpg&#34; /&gt;&lt;/p&gt;
&lt;p&gt;前几天，在微信公众号里看到有个R包（gganatogram) 可以画动物和植物的图形，但是里面的小麦不好看。于是把我用R画的小麦分享出来，比一比哪个更好看😜。&lt;/p&gt;
&lt;p&gt;话不多说，先上图。
&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/img1.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;先说说为什么要画这么一个图。&lt;/p&gt;
&lt;p&gt;那是在我刚进课题组的时候，就了解到实验室有大量小麦的数据。而且是从叶片到茎秆再到穗和籽粒等等各种器官一应俱全。更让人惊喜的是这些数据时间跨度大。当时我就在想，用什么样的方式才能展示出来这么丰富的空间和时间变化呢？&lt;/p&gt;
&lt;p&gt;一次偶然的机会，我联想到地图，地图里面的各个区域由多边形组成，区域的数值变化可以通过填色来完成。眼尖的同学应该看出来了，里面正是我华北平原的吴桥实验站（手动笑脸）。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/img2.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;而我们一株小麦上的各个器官正好对应着地图上不同区域。利用小麦不同器官的轮廓图，勾勒出多边形，再把多边形组合，就形成一株完整的小麦。&lt;/p&gt;
&lt;p&gt;有了这个想法之后，我就开始实施。首先从网上找到一株小麦的矢量图（就是各器官能分开的图形），然后根据各部分的轮廓创建多边形。是的，图形数据化用到了一款开源软件，名为&lt;a href=&#34;https://automeris.io/WebPlotDigitizer/&#34;&gt;WebPlotDigitizer&lt;/a&gt;。这款软件非常强大，可以提取图像或者图片中的坐标数据。这里特别提一句，小麦植株的比例做了一些微调，可能与真实的有点出入，但是不影响数据展示。还有一点，我们课题组专门研究地上部分的，暂时还没把根(器官)加进去，不过后期会考虑。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/img3.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/img4.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;多边形创建采用了专门处理gis数据的R包sf。&lt;/p&gt;
&lt;p&gt;最后的成品就是前面看到的这个样子了。每一个部分都可以根据自己的需求填上任意的颜色。而且颜色也可以根据需求自己选择，颜色的深浅代表指标的高低。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/img5.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;
也可以给每个部分添加标签，放上对应的数据。这样看起来好是不是好很多。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;再来一张动图看看。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/mygif.gif&#34; /&gt;&lt;/p&gt;
&lt;p&gt;好吧，最后公布一下那个R包里面的小麦。貌似也没那么难看 😄&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-draw-wheat-chart-in-r.en_files/wheatbygganotom.png&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Show the local weather</title>
      <link>/post/show-the-local-weather/</link>
      <pubDate>Sat, 04 Jul 2020 00:00:00 +0000</pubDate>
      <guid>/post/show-the-local-weather/</guid>
      <description>


&lt;p&gt;&lt;strong&gt;最近降雨似乎比往年多了很多，突然觉得有必要记录一下降雨的数据&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;下面就是从中国气象数据网获得的逐小时数据分析顺义降雨情况。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据是从6月19号开始收集的，先展示一下小时的降水&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;C&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-show-the-local-weather.en_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;降雨集中的几个小时，数据挤在一起就不好看清楚了。于是进一步算了一下日降水量。并且我们还关注最近7天累计的降水有多少。所以用折线加散点的方式展示了近7天的累计降水。最后可以看出，近7日的累计降水达到11.5 mm&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-show-the-local-weather.en_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;
&lt;strong&gt;再看下海淀区的情况，最近降水比顺义多好多，近7日总降水达到100mm&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-07-04-show-the-local-weather.en_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
